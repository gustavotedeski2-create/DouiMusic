<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Music Library</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root { --bg1:#1d2671;--bg2:#c33764;--card:#00000099;--text:#fff;--accent:#fff; }
body.light { --bg1:#e0e0ff;--bg2:#ffc0d9;--card:#ffffffdd;--text:#000;--accent:#000; }
body {
  margin:0;font-family:Arial,sans-serif;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  color:var(--text);display:flex;justify-content:center;align-items:center;min-height:100vh;
}
.player {
  background:var(--card);backdrop-filter:blur(10px);
  width:95%;max-width:420px;border-radius:20px;padding:20px;
  box-shadow:0 20px 40px rgba(0,0,0,0.4);
}
.top{display:flex;justify-content:space-between;align-items:center;}
h1{text-align:center;margin:5px 0 5px;}
.artist{font-size:14px;text-align:center;opacity:0.8;margin-bottom:5px;}
.manual{display:none;margin-bottom:8px;}
.search{margin-bottom:8px;}
.search input, .search select{width:100%;padding:8px;border-radius:8px;border:none;}
.list{max-height:200px;overflow:auto;}
.track{padding:8px;border-radius:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;position:relative}
.track.active{background:rgba(255,255,255,0.3)}
.controls{display:flex;justify-content:space-between;margin-top:10px;flex-wrap:wrap;gap:6px;}
.controls button{
  background:none;border:2px solid var(--accent);color:var(--accent);
  border-radius:50%;width:48px;height:48px;font-size:18px;
}
.toggle{cursor:pointer;}
.add,.remove{opacity:.6;cursor:pointer;margin-left:6px}
.add:hover,.remove:hover{opacity:1}
.playlistMenu{
  position:absolute;right:8px;top:36px;background:var(--card);
  border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.4);
  overflow:hidden;z-index:10;
}
.playlistMenu div{padding:8px 12px;cursor:pointer;white-space:nowrap;}
.playlistMenu div:hover{background:rgba(255,255,255,0.2);}
.deletePlaylist{
  text-align:center;padding:8px;background:rgba(255,0,0,0.2);
  cursor:pointer;border-radius:8px;margin-top:6px;
}
.deletePlaylist:hover{background:rgba(255,0,0,0.35)}
.volumeBox{display:flex;align-items:center;gap:8px;margin-top:6px;}
.volumeBox input{flex:1}
.settings{cursor:pointer;font-size:20px;}
.settingsMenu{
  position:absolute;right:10px;top:50px;background:var(--card);
  border-radius:10px;padding:10px;box-shadow:0 10px 30px rgba(0,0,0,0.4);
  display:none;z-index:20;
}
.settingsMenu label{display:flex;align-items:center;gap:8px;cursor:pointer;}
.editFields{display:none;margin-top:4px;}
.editFields input{width:100%;padding:4px;margin-top:4px;border-radius:6px;border:none;}

.artistWarning{
  font-size:12px;background:rgba(255,255,255,0.12);
  padding:8px;border-radius:8px;line-height:1.4;text-align:center;
}
.closeWarning{display:inline-block;margin-top:4px;font-size:11px;cursor:pointer;opacity:.7;}
.closeWarning:hover{opacity:1;}
</style>
</head>
<body>

<div class="player">
  <div class="top">
    <h1>Pato Player</h1>
    <div style="display:flex;gap:10px;align-items:center">
      <div class="settings" onclick="toggleSettings()">‚öôÔ∏è</div>
      <div class="toggle" onclick="toggleTheme()">üåô</div>
    </div>
  </div>

  <div class="settingsMenu" id="settingsMenu">
    <label>
      <input type="checkbox" id="editModeToggle" onchange="toggleEditMode(this.checked)">
      Modo personalizar m√∫sicas
    </label>
  </div>

  <div class="artist" id="artistName"></div>

  <div class="manual" id="manualArtist">
    <div class="artistWarning">
      ‚ö†Ô∏è <strong>Artista n√£o encontrado!</strong><br>
      Mude em: <em>Configura√ß√µes (‚öôÔ∏è) ‚Üí Habilitar Modo personalizar m√∫sicas</em><br>
      <span class="closeWarning" onclick="hideArtistWarning()">‚úñ fechar</span>
    </div>
  </div>

  <div class="search"><input id="search" placeholder="Buscar m√∫sica..." oninput="applySearch(this.value)"></div>
  <div class="search"><input placeholder="Nova playlist..." onkeydown="if(event.key==='Enter')createPlaylist(this.value,this)"></div>
  <div class="search"><select id="playlistSelect" onchange="switchPlaylist(this.value)"><option value="">üìö Biblioteca</option></select></div>

  <audio id="audio" controls></audio>

  <div class="volumeBox">üîà <input type="range" min="0" max="100" value="15" oninput="setVolume(this.value)"></div>

  <div class="controls">
    <button onclick="prev()">‚èÆ</button>
    <button onclick="playPause()">‚ñ∂Ô∏è</button>
    <button onclick="next()">‚è≠</button>
    <button onclick="toggleShuffle()">üîÄ</button>
    <button onclick="toggleRepeat()">üîÅ</button>
  </div>

  <div id="deletePlaylistBtn" class="deletePlaylist" style="display:none" onclick="deleteCurrentPlaylist()">üóë Excluir playlist atual</div>

  <div class="list" id="list"></div>
</div>

<script>
const API="https://api.github.com/repos/gustavotedeski2-create/music-library/contents/Musicas";
let tracks=[], order=[], current=0, shuffle=false, repeatMode=0;
let playlists = JSON.parse(localStorage.getItem("playlists")||"{}");
let currentPlaylist = null;
let editMode = false;
let showArtistWarning = true;

fetch(API).then(r=>r.json()).then(files=>{
  tracks = files.filter(f=>f.type==="file" && /\.(mp3|m4a|mp4)$/i.test(f.name))
    .map(f=>{
      const clean = f.name.replace(/\.[^/.]+$/, "");
      const parts = clean.split(" - ");
      return {
        ...f,
        artist: parts.length > 1 ? parts[0] : null,
        title: parts.length > 1 ? parts.slice(1).join(" - ") : clean,
        manualArtist:null,
        manualTitle:null
      }
    });
  order=[...tracks.keys()];
  renderPlaylists(); render(); load(0);
});

function toggleSettings(){settingsMenu.style.display=settingsMenu.style.display==="block"?"none":"block";}
function toggleEditMode(v){editMode=v;render();}
function hideArtistWarning(){manualArtist.style.display="none";}
function setVolume(v){audio.volume=v/100;}

function savePlaylists(){localStorage.setItem("playlists",JSON.stringify(playlists));}
function renderPlaylists(){
  playlistSelect.innerHTML=`<option value="">üìö Biblioteca</option>`;
  Object.keys(playlists).forEach(p=>playlistSelect.append(new Option("üéµ "+p,p)));
}

function createPlaylist(n,i){if(!n||playlists[n])return;playlists[n]=[];savePlaylists();renderPlaylists();i.value="";}
function switchPlaylist(n){currentPlaylist=n||null;order=n?playlists[n]:[...tracks.keys()];current=0;deletePlaylistBtn.style.display=n?"block":"none";render();if(order.length)load(0);}
function deleteCurrentPlaylist(){if(!currentPlaylist)return;delete playlists[currentPlaylist];savePlaylists();switchPlaylist("");}

function render(){
  list.innerHTML="";
  order.forEach((idx,i)=>{
    const t=tracks[idx];
    const d=document.createElement("div");
    d.className="track";
    const artist=t.manualArtist||t.artist||"Artista indefinido";
    const title=t.manualTitle||t.title;
    d.innerHTML=`<span>${artist} ‚Äî ${title}${editMode?`<div class="editFields"><input value="${artist}" onblur="updateArtist(${idx},this.value)"><input value="${title}" onblur="updateTitle(${idx},this.value)"></div>`:""}</span>
    <span><span class="add">‚ûï</span>${currentPlaylist?`<span class="remove">‚ùå</span>`:""}</span>`;
    d.querySelector(".add").onclick=e=>{e.stopPropagation();showPlaylistMenu(idx,e.target);}
    if(currentPlaylist)d.querySelector(".remove").onclick=e=>{e.stopPropagation();playlists[currentPlaylist]=playlists[currentPlaylist].filter(x=>x!==idx);savePlaylists();order=playlists[currentPlaylist];render();}
    d.onclick=()=>load(i);
    list.appendChild(d);
  });
  highlight();
  document.querySelectorAll(".editFields").forEach(e=>e.style.display=editMode?"block":"none");
}

function showPlaylistMenu(idx,el){
  document.querySelectorAll(".playlistMenu").forEach(m=>m.remove());
  const m=document.createElement("div");m.className="playlistMenu";
  Object.keys(playlists).forEach(p=>{
    const d=document.createElement("div");d.textContent="‚ûï "+p;
    d.onclick=()=>{if(!playlists[p].includes(idx)){playlists[p].push(idx);savePlaylists();}m.remove();}
    m.appendChild(d);
  });
  el.parentElement.appendChild(m);
}

function load(i){
  current=i;
  const t=tracks[order[i]];
  audio.src=t.download_url;
  artistName.textContent=t.manualArtist||t.artist||"Artista n√£o encontrado";
  manualArtist.style.display=!t.artist&&showArtistWarning?"block":"none";
  document.title=(t.manualArtist||t.artist||"")+" ‚Äî "+(t.manualTitle||t.title);
  audio.play();highlight();
}
function playPause(){ audio.paused?audio.play():audio.pause(); }

function next(){
  if(current < order.length-1) load(current+1);
  else if(repeatMode===1) load(0);
}

function prev(){
  if(current>0) load(current-1);
  else if(repeatMode===1) load(order.length-1);
}

function toggleShuffle(){
  shuffle=!shuffle;
  order = shuffle ? [...order].sort(()=>Math.random()-0.5) : [...tracks.keys()];
  current = 0;
  render(); load(current);
}

function toggleRepeat(){
  repeatMode = (repeatMode + 1) % 3;
  const btn = document.querySelector('button[onclick="toggleRepeat()"]');
  btn.textContent = repeatMode === 0 ? "üîÅ" : repeatMode === 1 ? "üîÇ" : "üîÅ1";
}

audio.onended = () => {
  if (repeatMode === 2) {
    audio.currentTime = 0;
    audio.play();
  } else if (current < order.length - 1) {
    load(current + 1);
  } else if (repeatMode === 1) {
    load(0);
  }
};

function toggleTheme(){ document.body.classList.toggle("light"); }
function applySearch(q){
  q=q.toLowerCase();
  order=tracks.map((t,i)=>({t,i})).filter(x=>{
    const artist=(x.t.manualArtist||x.t.artist||"").toLowerCase();
    const title=(x.t.manualTitle||x.t.title).toLowerCase();
    return artist.includes(q)||title.includes(q);
  }).map(x=>x.i);
  current=0;render();if(order.length)load(0);
}
</script>

</body>
</html>
